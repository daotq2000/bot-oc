# Database Configuration
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=rootpassword
DB_NAME=bot_oc_xuoi

# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=8258258913:AAF766lMi3YciiJs-bFTV6rU7zLy-G4-xx0
TELEGRAM_BOT_TOKEN_SEND_ALERT_BINANCE=8597089470:AAHDDNxAuozJm6cyLGopH97Ak644esxkirQ
TELEGRAM_BOT_TOKEN_SEND_ALERT_MEXC=8378731875:AAFNVFexcmZuo56pACjcYnn5hnpdCA6QZ1U
TELEGRAM_BOT_TOKEN_POSITION_MONITOR_BINANCE=8355108901:AAGneTYUPQ0nKFijNljh666JIYd2N8ROKa8
TELEGRAM_BOT_TOKEN_POSITION_MONITOR_BINANCE_CHANEL=-1003636062941
LOG_LEVEL=info
# Server Configuration  
PORT=3002
NODE_ENV=dev
ENABLE_POSITION_SYNC=true
# Logging
BINANCE_SANDBOX=true
BINANCE_FUTURES_ENDPOINT=https://testnet.binancefuture.com
BINANCE_DEMO_TRADING_ENDPOINT=https://testnet.binancefuture.com

# ===== BINANCE WEBSOCKET OPTIMIZATION =====
# Binance limit: 200 streams/connection, 5 connections/5s, 10 messages/s
# Recommended: 50-100 streams/conn for optimal latency
BINANCE_WS_MAX_STREAMS_PER_CONN=100
# Max total streams (each symbol = 2 streams: bookTicker + kline_1m)
# 1000 streams = ~500 symbols
BINANCE_WS_MAX_TOTAL_STREAMS=1200
# Tick processing optimization
BINANCE_WS_TICK_DRAIN_BATCH_SIZE=1000
BINANCE_WS_TICK_DRAIN_TIME_BUDGET_MS=15
# Prevent cleanup of symbols with alerts/positions
BINANCE_WS_SYMBOL_UNUSED_TIMEOUT_MS=7200000

ADV_TPSL_MTF_ENABLED=false,
ADV_TPSL_LOSS_STREAK_ENABLED=true
ADV_TPSL_LOSS_STREAK_MAX=5
ADV_TPSL_LOSS_STREAK_PAUSE_MINS=30
ADV_TPSL_AUTO_OPTIMIZE_ENABLED=false
ADV_TPSL_ENABLED=true
ADV_TPSL_SR_ENABLED=true
ADV_TPSL_MTF_ENABLED=true

ADV_TPSL_MAX_POSITIONS_PER_CYCLE=10
ADV_TPSL_MAX_CONCURRENT=1
ADV_TPSL_POSITION_COOLDOWN_MS=300000
ADV_TPSL_ALLOW_WHEN_NO_TPSL=false
PNL_ALERT_INTERVAL_MS=0
CANDLE_DB_PRUNE_ENABLED=true
CANDLE_DB_PRUNE_INTERVAL_MS=3600000  # 1 giờ
CANDLE_DB_PRUNE_MAX_KEYS_PER_CYCLE=200
CANDLE_DB_KEEP_LAST_1M=60    # Giữ lại 12 giờ dữ liệu 1m
CANDLE_DB_KEEP_LAST_5M=60   # Giữ lại 7 ngày dữ liệu 5m
INDICATORS_WARMUP_ENABLED=true

# ===== ENTRY FILTERS (Cân bằng: tăng trades mà vẫn giữ Win Rate tốt) =====
# EMA Separation: 0.001 = 0.1% (nới lỏng từ 0.3% để cho nhiều trades hơn)
# Lý do: ema_flat chiếm 97% reject, cần nới lỏng
EMA_SEPARATION_MIN=0.001
TREND_EMA_SEPARATION_MIN=0.001
RSI_OVERSOLD=30
RSI_OVERBOUGHT=70
TREND_RSI_OVERBOUGHT=70
TREND_RSI_OVERSOLD=30

# ===== AUTO-REFRESH STALE TP/SL =====
# Cancel and recreate TP/SL orders that have been pending > X minutes
# This allows TP/SL prices to be recalculated based on current market conditions
# Set to 0 to disable
TPSL_STALE_MINUTES=10

# ===== TRAILING & BREAK-EVEN =====
ADV_TPSL_TRAILING_ENABLED=true
ADV_TPSL_TRAILING_BUFFER_PCT=0.1
ADV_TPSL_TRAILING_LOCK_RATIO=0.6
ADV_TPSL_PROFIT_LOCK_LEVELS=[[1,0],[2,0.3],[3,0.5],[5,0.7],[8,0.8]]

# ===== BREAK-EVEN (Lock profit sớm hơn) =====
ADV_TPSL_BREAK_EVEN_ENABLED=true
ADV_TPSL_BREAK_EVEN_PCT=1.5
ADV_TPSL_BREAK_EVEN_BUFFER_PCT=0.1

# ===== ATR-BASED TP/SL (Dynamic levels) =====
ADV_TPSL_ATR_ENABLED=true
ADV_TPSL_ATR_TIMEFRAME=1h
ADV_TPSL_ATR_PERIOD=14
ADV_TPSL_ATR_TP_MULT=3.0
ADV_TPSL_ATR_SL_MULT=1.5

# ===== PARTIAL TAKE PROFIT =====
ADV_TPSL_PARTIAL_TP_ENABLED=true

# ===== RISK/REWARD =====
ADV_TPSL_RR_ENABLED=true
ADV_TPSL_MIN_RR=2.0

TREND_ADX_SCORE_THRESHOLD=20
# ===== VOLUME & VOLATILITY FILTERS =====
# Nới lỏng Volume VMA từ 1.5x xuống 1.2x để cho nhiều trades hơn
VOLUME_VMA_MIN_RATIO=1.2
VOL_ATR_MAX_PCT=2.5
# PositionSync
POSITION_SYNC_INTERVAL_MS=30000  # 30s

# Market Regime Filter
MARKET_REGIME_FILTER_ENABLED=true
REGIME_ADX_STRONG_TREND=30
REGIME_ADX_WEAK_TREND=20

# Funding Rate Filter
FUNDING_RATE_FILTER_ENABLED=true
FUNDING_EXTREME_POSITIVE=0.10
FUNDING_EXTREME_NEGATIVE=-0.10

# ===== VOLATILITY FILTER =====
VOLATILITY_FILTER_ENABLED=true
# Nới lỏng VOL_ATR_MIN từ 0.5% xuống 0.3% 
VOL_ATR_MIN_PCT=0.3
VOL_ATR_MAX_PCT=3.0

# ===== VOLUME VMA GATE =====
VOLUME_VMA_GATE_ENABLED=true
VOLUME_VMA_MIN_RATIO=1.2

# ===== PULLBACK CONFIRMATION =====
# Tắt pullback để cho nhiều trades hơn (đã có EMA/RSI filter)
PULLBACK_CONFIRMATION_ENABLED=false

# ===== RVOL FILTER =====
RVOL_FILTER_ENABLED=true
# Nới lỏng RVOL từ 1.5 xuống 1.0 (volume >= average)
RVOL_MIN=1.0

# ===== SOFTWARE STOP LOSS (Bảo vệ vốn) =====
SOFTWARE_SL_ENABLED=true
SOFTWARE_SL_CHECK_INTERVAL_MS=300

# ===== POSITION LIMITS =====
MAX_CONCURRENT_TRADES=200
MAX_AMOUNT_PER_COIN=500
MIN_NOTIONAL=50

# ===== TPSL QUEUE (Performance) =====
TPSL_QUEUE_CONCURRENCY_PER_BOT=3
TPSL_QUEUE_GLOBAL_CONCURRENCY=8

TREND_ADX_STRONG_TREND=35
TREND_RSI_OVERBOUGHT_STRONG=80
TREND_RSI_OVERSOLD_STRONG=20

# Dynamic ATR
VOL_ATR_MAX_STRONG_PCT=2.5

# Candle Body
CANDLE_BODY_FILTER_ENABLED=true
CANDLE_BODY_MIN_RATIO=0.5
DEBUG_OC_DETECTION=true